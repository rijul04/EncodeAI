var D=(t=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(t,{get:(e,n)=>(typeof require<"u"?require:e)[n]}):t)(function(t){if(typeof require<"u")return require.apply(this,arguments);throw Error('Dynamic require of "'+t+'" is not supported')});import"ai";import"zod";var l=(r=>(r[r.ERROR=0]="ERROR",r[r.WARN=1]="WARN",r[r.INFO=2]="INFO",r[r.DEBUG=3]="DEBUG",r[r.TRACE=4]="TRACE",r))(l||{}),R=(i=>(i.INPUT="input",i.OUTPUT="output",i.ACTION="action",i))(R||{});var T=class{config;logWriter;constructor(e){if(this.config={level:e.level,enableTimestamp:e.enableTimestamp??!0,enableColors:e.enableColors??!0,logToFile:e.logToFile??!1,logPath:e.logPath??"./logs"},this.config.logToFile&&!e.logWriter)throw new Error("LogWriter must be provided when logToFile is enabled");e.logWriter&&(this.logWriter=e.logWriter)}error(e,n,i){this.log(0,e,n,i),i&&console.error(i)}warn(e,n,i){this.log(1,e,n,i)}info(e,n,i){this.log(2,e,n,i)}debug(e,n,i){this.log(3,e,n,i)}trace(e,n,i){this.log(4,e,n,i)}log(e,n,i,o){if(e>this.config.level)return;let r={level:e,timestamp:new Date,context:n,message:i,data:o},s=this.formatLogEntry(r);this.config.enableColors?console.log(this.colorize(s,e)):console.log(s),this.config.logToFile&&this.writeToFile(r)}formatLogEntry(e){let n=[];return this.config.enableTimestamp&&n.push(`[${e.timestamp.toISOString()}]`),n.push(`[${l[e.level]}]`),n.push(`[${e.context}]`),n.push(e.message),e.data&&n.push(JSON.stringify(e.data,null,2)),n.join(" ")}colorize(e,n){return`${{0:"\x1B[31m",1:"\x1B[33m",2:"\x1B[36m",3:"\x1B[32m",4:"\x1B[90m"}[n]}${e}\x1B[0m`}initLogFile(){if(!this.logWriter)throw new Error("LogWriter not configured");this.logWriter.init(this.config.logPath)}writeToFile(e){if(!this.logWriter)throw new Error("LogWriter not configured");let n=this.formatLogEntry(e)+`
`;this.logWriter.write(n)}};var J=t=>t,q=t=>{let e={providers:[],booted:new Set,registered:new Set},n=(o,r)=>{e.registered.has(r)||(e.registered.add(r),r.register&&r.register(o))},i=async(o,r)=>{e.booted.has(r)||(e.booted.add(r),r.boot&&await r.boot(o))};return{register:o=>{e.providers.includes(o)||(e.providers.push(o),n(t,o))},bootAll:async()=>{for(let o of e.providers)n(t,o);for(let o of e.providers)await i(t,o)},isBooted:o=>e.booted.has(o),isRegistered:o=>e.registered.has(o)}};function a({tag:t,params:e,content:n}){let i=e?Object.entries(e).map(([o,r])=>` ${o}="${r}"`).join(""):"";try{return`<${t}${i}>${typeof n=="string"?n:Array.isArray(n)?`
`+n.map(o=>typeof o=="string"?o:a(o)).join(`
`)+`
`:""}</${t}>`}catch(o){throw console.log("failed to format",{tag:t,params:e,content:n}),o}}function M(t){return new RegExp(`(<${t}(?:\\s+[^>]*)?>)([\\s\\S]*?)</${t}>`,"gs")}function _(t,e){let n=M(t);return i=>{let o=Array.from(i.matchAll(n));try{return o.map(r=>({tag:t,params:r[1]?f(r[1]):{},content:e?e(r[2]?.trim()):r[2]?.trim()}))}catch(r){throw r}}}function f(t){let e={};if(t.length===0)return e;let n=t.matchAll(/(\w+)="([^"]*)"/g);for(let i of n)e[i[1]]=i[2];return e}function P(t,e,n=0,i=void 0){let o=[],r=t.trim();for(;r.length>0;){let s=r.indexOf("<");if(s===-1){let u={type:"text",content:r.trim()};o.push(e(u,()=>[]));break}let g=r.indexOf(">",s);if(s>0||g===-1){let u={type:"text",content:r.slice(0,g===-1?-1:s).trim()};o.push(e(u,()=>[]))}if(g===-1)break;let p=r.slice(s+1,g),c=!1;p.at(-1)==="/"&&(c=!0,p=p.slice(0,-1));let[y,...O]=p.split(" "),C=f(O.join(" ").trim());if(c){r=r.slice(g+1).trim(),o.push(e({type:"element",name:y,attributes:C,content:"",closed:c},()=>[]));continue}let A=`</${y}>`,x=r.indexOf(A);if(x===-1)break;let h=r.slice(g+1,x).trim(),d={type:"element",name:y,attributes:C,content:h};i&&(d.parent=i),o.push(e(d,()=>P(h,e,n+1,d))),r=r.slice(x+A.length).trim()}return o}function G(t){return t.type==="element"}function H(t){return t.type==="text"}function*K(t){let e="",n="";for(;;){let i=yield;if(i){for(e+=i;e.length>0;){let o=e.indexOf("<");if(o>0){let c=e.slice(0,o).trim();n+=c,e=e.slice(o);break}if(o===-1){n+=e,e="";break}let r=e.indexOf(">",o);if(r===-1)break;let s=e.slice(o+1,r),g=s.startsWith("/"),p=g?s.slice(1).trim().split(" ")[0]:s.trim().split(" ")[0];if(t.has(p))if(n&&(yield{type:"text",content:n},n=""),g)yield{type:"end",name:p};else{let c=f(s.slice(p.length));yield{type:"start",name:p,attributes:c}}else n+=e.slice(0,r+1);e=e.slice(r+1)}n&&(yield{type:"text",content:n},n="")}}}import{z as k}from"zod";import{v7 as mt}from"uuid";function tt(t,e){return t.trim().replace(/\{\{(\w+)\}\}/g,(n,i)=>m(e[i]??""))}function m(t){return Array.isArray(t)?t.map(e=>m(e)).join(`
`):typeof t!="string"?JSON.stringify(t,(e,n)=>typeof n=="bigint"?n.toString():n):t.trim()}function et(t){return t}function nt(t){return t}function rt(t){return t}function ot(t){return t}function it(t,e){let{maxChunkSize:n}=e,i=t.split(`
`),o=[],r="";for(let s of i)r.length+s.length+1>n?(r&&o.push(r.trim()),r=s):r=r?r+`
`+s:s;return r&&o.push(r.trim()),o}function E(t){return t}function st(t){return t}function at(t,e=process.env){try{return t.parse(e)}catch(n){throw n instanceof k.ZodError&&(console.error("Environment validation failed:"),n.errors.forEach(i=>{console.error(`- ${i.message}`)}),process.exit(1)),n}}var I={thoughts:6,inputs:20,outputs:20,actions:20};function gt(t,e=I){t.thoughts=t.thoughts.slice(-e.thoughts),t.inputs=t.inputs.slice(-e.inputs),t.outputs=t.outputs.slice(-e.outputs),t.calls=t.calls.slice(-e.actions),t.results=t.results.slice(-e.actions)}import S from"zod-to-json-schema";import{z}from"zod";function ut(t){return t}function N(t,e=!0){return[...t.inputs??[],...t.outputs??[],...t.calls??[],...(e?t.thoughts:void 0)??[],...t.results??[]].sort((n,i)=>n.timestamp>i.timestamp?1:-1)}function v({memory:t,processed:e}){return N(t,!1).filter(n=>n.processed===e).map(n=>b(n)).flat()}function W(){return{inputs:[],outputs:[],thoughts:[],calls:[],results:[]}}var L={key:"working-memory",create:W},lt={type:"default",schema:z.string(),key:t=>t,create(t){return{test:!0}}};function ft(t,e){let n=t.key?t.key(e):t.type;return t.key?[t.type,n].join(":"):t.type}async function Ct(t,e,n){let i=e.key?e.key(n):e.type,o=e.key?[e.type,i].join(":"):e.type,r=e.setup?await e.setup(n,t):{},s=await t.memory.store.get(o)??(e.create?e.create({key:i,args:n,context:e,id:o,options:r}):{});return{id:o,key:i,args:n,options:r,context:e,memory:s}}async function At(t,e){return await t.memory.store.get([e,"working-memory"].join(":"))??await L.create()}async function ht(t,e,n){return await t.memory.store.set([e,"working-memory"].join(":"),n)}function Rt(t){return a({tag:"input",params:{name:t.type,...t.params},content:typeof t.data=="string"?t.data:JSON.stringify(t.data)})}function Mt(t){return a({tag:"output",params:{name:t.type,...t.params},content:typeof t.data=="string"?t.data:JSON.stringify(t.data)})}function Pt(t){let e={name:t.type};return t.required&&(e.required="true"),a({tag:"output",params:e,content:[t.description?{tag:"description",content:t.description}:null,t.instructions?{tag:"instructions",content:t.instructions}:null,t.schema?{tag:"schema",content:JSON.stringify(S(t.schema,"output"))}:null].filter(n=>!!n)})}function kt(t){return a({tag:"action",params:{name:t.name},content:[t.description?{tag:"description",content:t.description}:null,t.instructions?{tag:"instructions",content:t.instructions}:null,t.schema?{tag:"schema",content:JSON.stringify(S(t.schema,"action"))}:null].filter(e=>!!e)})}function w({type:t,key:e,description:n,instructions:i,content:o}){return a({tag:"context",params:{type:t,key:e},content:[n?a({tag:"description",content:n}):"",i?a({tag:"instructions",content:i}):"",o].filter(r=>!!r).flat()})}function Et(t){return a({tag:"msg",params:t.role==="user"?{role:"user",user:t.user}:{role:"assistant"},content:t.content})}function b(t){switch(t.ref){case"input":return t.formatted??a({tag:"msg",params:{...t.params,role:"user"},content:m(t.data)});case"output":return t.formatted??a({tag:"output",params:{type:t.type,...t.params},content:m(t.data)});case"thought":return a({tag:"reasoning",content:t.content});case"action_call":return a({tag:"action_call",params:{id:t.id,name:t.name},content:JSON.stringify(t.data)});case"action_result":return a({tag:"action_result",params:{name:t.name,callId:t.callId},content:t.formatted??JSON.stringify(t.data)});default:throw new Error("invalid context")}}function It(t,e,n){return e.map(({id:i,context:o,key:r,args:s,memory:g,options:p})=>w({type:o.type,key:r,description:typeof o.description=="function"?o.description({key:r,args:s,options:p,id:i,context:o,memory:g}):o.description,instructions:typeof o.instructions=="function"?o.instructions({key:r,args:s,options:p,id:i,context:o,memory:g}):o.instructions,content:[o.render?o.render({id:i,context:o,key:r,args:s,memory:g,options:p}):"",t===i?v({memory:n,processed:!0}):""].flat().filter(c=>!!c)})).flat().join(`
`)}export{D as a,l as b,R as c,T as d,J as e,q as f,a as g,M as h,_ as i,f as j,P as k,G as l,H as m,K as n,tt as o,m as p,et as q,nt as r,rt as s,ot as t,it as u,E as v,st as w,at as x,gt as y,mt as z,Rt as A,Mt as B,Pt as C,kt as D,w as E,Et as F,b as G,It as H,ut as I,N as J,v as K,W as L,L as M,lt as N,ft as O,Ct as P,At as Q,ht as R};
//# sourceMappingURL=chunk-3S76ZAL5.js.map